<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rezervace sedadel - Kino</title>
  <style>
    :root{
      --gap: 12px;
      --seat-size: 44px;
      --available: #e6f7ff;
      --selected: #60a5fa;
      --reserved: #94a3b8;
      --aisle-width: 28px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{display:flex;min-height:100vh;align-items:center;justify-content:center;background:#f8fafc;margin:0;padding:24px}
    .container{max-width:900px;width:100%;background:white;border-radius:12px;padding:20px;box-shadow:0 6px 20px rgba(2,6,23,0.06)}
    h1{margin:0 0 10px;font-size:20px}
    p.lead{margin:0 0 18px;color:#475569}

    .screen{height:18px;background:linear-gradient(90deg,#c7e0ff,#eef6ff);border-radius:8px;text-align:center;padding:6px 10px;margin:0 auto 18px;color:#0f172a;font-weight:600;max-width:420px}
    .theater{display:flex;gap:var(--aisle-width);align-items:flex-start;justify-content:center}
    .block{display:grid;grid-auto-rows:var(--seat-size);grid-auto-columns:var(--seat-size);gap:var(--gap);padding:6px}
    .left{grid-template-columns:repeat(3, var(--seat-size));grid-template-rows:repeat(3, var(--seat-size));}
    .right{grid-template-columns:repeat(4, var(--seat-size));grid-template-rows:repeat(3, var(--seat-size));}
    .seat{width:var(--seat-size);height:var(--seat-size);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:600;cursor:pointer;border:2px solid rgba(15,23,42,0.08);user-select:none;background:var(--available);transition:transform .08s ease, box-shadow .08s ease;}
    .seat:active{transform:scale(.98)}
    .seat.reserved{background:var(--reserved);cursor:not-allowed;opacity:0.9}
    .seat.selected{background:var(--selected);color:white}
    .legend{display:flex;gap:12px;align-items:center;margin-top:14px}
    .legend span{display:flex;gap:6px;align-items:center}
    .sw{width:20px;height:20px;border-radius:6px}
    .controls{display:flex;gap:10px;align-items:center;margin-top:16px;flex-wrap:wrap}
    button{background:#0ea5a4;border:none;padding:10px 14px;border-radius:8px;color:white;font-weight:600;cursor:pointer}
    button.secondary{background:#64748b}
    .info{margin-left:auto;color:#334155}
    form{margin-top:20px;display:none;flex-direction:column;gap:10px}
    label{font-weight:600;color:#1e293b}
    input{padding:8px 10px;border:1px solid #cbd5e1;border-radius:6px;width:100%;max-width:300px}
    #successMsg{display:none;margin-top:20px;padding:15px;background:#dcfce7;border:1px solid #86efac;border-radius:8px;color:#166534;font-weight:600;}
    #adminPanel{display:none;margin-top:25px;}
    table{border-collapse:collapse;width:100%;margin-top:10px}
    th,td{border:1px solid #cbd5e1;padding:6px;text-align:left}
    th{background:#f1f5f9}
    @media (max-width:520px){.theater{gap:12px;flex-direction:column;align-items:center}}
  </style>
</head>
<body>
  <div class="container">
    <h1>Angel Pine Cinema</h1>
    <p class="lead">Rezervace sedadel na SO 11.10.2025, film Šmoulové. Kliknutím vyberte sedadla a vyplňte formulář.</p>

    <div class="screen">PLÁTNO</div>
    <div class="theater" id="theater"></div>

    <div class="legend">
      <span><i class="sw" style="background:var(--available);border:2px solid rgba(15,23,42,0.06)"></i> Volné</span>
      <span><i class="sw" style="background:var(--selected)"></i> Vybrané</span>
      <span><i class="sw" style="background:var(--reserved)"></i> Rezervované</span>
    </div>

    <div class="controls">
      <button id="reserveBtn">Rezervovat</button>
      <button id="clearSelection" class="secondary">Zrušit výběr</button>
      <button id="adminBtn" class="secondary">Admin panel</button>
      <div class="info" id="info">Vybráno: 0</div>
    </div>

    <form id="reservationForm">
      <label for="firstName">Jméno:</label>
      <input type="text" id="firstName" required>
      <label for="lastName">Příjmení:</label>
      <input type="text" id="lastName" required>
      <label for="email">Email:</label>
      <input type="email" id="email" required>
      <button type="submit">Odeslat rezervaci</button>
    </form>

    <div id="successMsg"></div>
    <div id="adminPanel">
      <h2>Administrátor — seznam rezervací</h2>
      <table id="adminTable">
        <thead><tr><th>Jméno</th><th>Příjmení</th><th>Email</th><th>Sedadla</th><th>Akce</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const layout = { left: {cols:3, rows:3, prefix:'L'}, right:{cols:4, rows:3, prefix:'R'} };
    const LS_KEY = 'kino_reserved';
    const LS_USERS = 'kino_users';

    const theaterEl = document.getElementById('theater');
    const infoEl = document.getElementById('info');
    const reserveBtn = document.getElementById('reserveBtn');
    const clearBtn = document.getElementById('clearSelection');
    const formEl = document.getElementById('reservationForm');
    const successMsg = document.getElementById('successMsg');
    const adminBtn = document.getElementById('adminBtn');
    const adminPanel = document.getElementById('adminPanel');

    let reserved = new Set(JSON.parse(localStorage.getItem(LS_KEY) || '[]'));
    let selected = new Set();

    function createBlock(kind){
      const cfg = layout[kind];
      const block = document.createElement('div');
      block.className = 'block ' + kind;
      for(let r=1;r<=cfg.rows;r++){
        for(let c=1;c<=cfg.cols;c++){
          const id = `${cfg.prefix}${r}${String.fromCharCode(64 + c)}`;
          const seat = document.createElement('button');
          seat.className = 'seat';
          seat.type = 'button';
          seat.dataset.seat = id;
          seat.textContent = id;
          if(reserved.has(id)){ seat.classList.add('reserved'); seat.disabled=true; }
          seat.addEventListener('click', ()=>{
            if(seat.classList.contains('reserved')) return;
            if(selected.has(id)){ selected.delete(id); seat.classList.remove('selected'); }
            else { selected.add(id); seat.classList.add('selected'); }
            infoEl.textContent = `Vybráno: ${selected.size}`;
          });
          block.appendChild(seat);
        }
      }
      return block;
    }

    function render(){
      theaterEl.innerHTML='';
      theaterEl.appendChild(createBlock('left'));
      theaterEl.appendChild(createBlock('right'));
    }

    reserveBtn.addEventListener('click', ()=>{
      if(selected.size===0){ alert('Vyberte alespoň jedno sedadlo.'); return; }
      formEl.style.display='flex';
      successMsg.style.display='none';
    });

    formEl.addEventListener('submit', e=>{
      e.preventDefault();
      const users = JSON.parse(localStorage.getItem(LS_USERS) || '[]');
      const user = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        seats: Array.from(selected)
      };
      users.push(user);
      localStorage.setItem(LS_USERS, JSON.stringify(users));
      selected.forEach(s=>reserved.add(s));
      localStorage.setItem(LS_KEY, JSON.stringify(Array.from(reserved)));
      selected.clear(); render(); formEl.reset(); formEl.style.display='none';
      successMsg.innerHTML = 'Rezervace byla úspěšně provedena!<br>Zaplaťte částku <strong>50.000,-</strong> převodem na účet John Dreilor nejpozději do 24 hodin od provedení rezervace, jinak bude zrušena.';
      successMsg.style.display='block';
    });

    clearBtn.addEventListener('click', ()=>{ selected.clear(); render(); });

    adminBtn.addEventListener('click', ()=>{
      if(adminPanel.style.display === 'block') { adminPanel.style.display='none'; return; }
      const password = prompt('Zadejte admin heslo:');
      if(password !== 'APKINO14ADMIN'){ alert('Nesprávné heslo'); return; }
      adminPanel.style.display='block';
      renderAdmin();
    });

    function renderAdmin(){
      const tbody = adminPanel.querySelector('tbody');
      tbody.innerHTML='';
      const users = JSON.parse(localStorage.getItem(LS_USERS) || '[]');
      users.forEach((u,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${u.firstName}</td><td>${u.lastName}</td><td>${u.email}</td><td>${u.seats.join(', ')}</td><td><button data-index='${i}'>Smazat</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const idx = parseInt(e.target.dataset.index);
          const users = JSON.parse(localStorage.getItem(LS_USERS)||'[]');
          const removed = users.splice(idx,1)[0];
          localStorage.setItem(LS_USERS, JSON.stringify(users));
          let reservedArr = JSON.parse(localStorage.getItem(LS_KEY)||'[]');
          reservedArr = reservedArr.filter(r=> !removed.seats.includes(r));
          localStorage.setItem(LS_KEY, JSON.stringify(reservedArr));
          reserved = new Set(reservedArr);
          render();
          renderAdmin();
        });
      });
    }

    render();
  </script>
</body>
</html>
